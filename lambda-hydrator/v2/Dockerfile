FROM node:15-alpine

RUN apk update

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

COPY . .

ENV \
	AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
	AWS_REGION=$AWS_REGION \
	AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
	CLOUDEVENTS_ID=$CLOUDEVENTS_ID \
	CLOUDEVENTS_MECHANISM=$CLOUDEVENTS_MECHANISM \
	CLOUDEVENTS_PASSWORD=$CLOUDEVENTS_PASSWORD \
	CLOUDEVENTS_PROTOCOL=$CLOUDEVENTS_PROTOCOL \
	CLOUDEVENTS_URLS=$CLOUDEVENTS_URLS \
	CLOUDEVENTS_USERNAME=$CLOUDEVENTS_USERNAME \
	HOST=0.0.0.0 \
	MAPS_JSON=[]\
	NODE_ENV=production

CMD [ "npm", "run", "start" ]

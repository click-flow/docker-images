FROM node:15-alpine

RUN apk update

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

COPY . .

ENV \
	AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
	AWS_REGION=$AWS_REGION \
	AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
	CLOUDEVENT_STREAMID=$CLOUDEVENT_STREAMID \
	CLOUDEVENT_STREAMMECHANISM=$CLOUDEVENT_STREAMMECHANISM \
	CLOUDEVENT_STREAMPASSWORD=$CLOUDEVENT_STREAMPASSWORD \
	CLOUDEVENT_STREAMPROTOCOL=$CLOUDEVENT_STREAMPROTOCOL \
	CLOUDEVENT_STREAMURLS=$CLOUDEVENT_STREAMURLS \
	CLOUDEVENT_STREAMUSERNAME=$CLOUDEVENT_STREAMUSERNAME \
	HOST=0.0.0.0 \
	MAPS_JSON=[] \
	NODE_ENV=production

CMD [ "npm", "run", "start" ]

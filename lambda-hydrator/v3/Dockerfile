FROM node:15-alpine

RUN apk update

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

COPY . .

ENV \
	ARN_AND_TYPE_MAPS_JSON=[] \
	AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
	AWS_API_VERSION=2015-03-31 \
	AWS_REGION=$AWS_REGION \
	AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
	CLOUDEVENT_STREAM_ID=$CLOUDEVENT_STREAM_ID \
	CLOUDEVENT_STREAM_MECHANISM=$CLOUDEVENT_STREAM_MECHANISM \
	CLOUDEVENT_STREAM_PASSWORD=$CLOUDEVENT_STREAM_PASSWORD \
	CLOUDEVENT_STREAM_PROTOCOL=$CLOUDEVENT_STREAM_PROTOCOL \
	CLOUDEVENT_STREAM_URLS=$CLOUDEVENT_STREAM_URLS \
	CLOUDEVENT_STREAM_USERNAME=$CLOUDEVENT_STREAM_USERNAME \
	HOST=0.0.0.0 \
	NODE_ENV=production

CMD [ "npm", "run", "start" ]

FROM node:14-alpine

RUN apk update

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

COPY . .

ENV \
	AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} \
	AWS_LAMBDA_ARN=${AWS_LAMBDA_ARN} \
	AWS_REGION=${AWS_REGION} \
	AWS_SECRET_ACCRESS_KEY=${AWS_SECRET_ACCRESS_KEY} \
	CLOUDEVENT_ID=${CLOUDEVENT_ID} \
	CLOUDEVENT_MECHANISM=${CLOUDEVENT_MECHANISM} \
	CLOUDEVENT_PASSWORD=${CLOUDEVENT_PASSWORD} \
	CLOUDEVENT_PROTOCOL=${CLOUDEVENT_PROTOCOL} \
	CLOUDEVENT_TYPES=${CLOUDEVENT_TYPES} \
	CLOUDEVENT_URLS=${CLOUDEVENT_URLS} \
	CLOUDEVENT_USERNAME=${CLOUDEVENT_USERNAME} \
	NODE_ENV=production

CMD [ "npm", "run", "start" ]

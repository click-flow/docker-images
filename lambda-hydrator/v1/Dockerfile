FROM node:14-alpine

RUN apk update

WORKDIR /app

COPY package.json package-lock.json ./
RUN npm install

COPY . .

ENV \
	AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} \
	AWS_REGION=${AWS_REGION} \
	AWS_SECRET_ACCRESS_KEY=${AWS_SECRET_ACCRESS_KEY} \
	HOST=0.0.0.0 \
	MAP_JSON=${MAP_JSON} \
	NODE_ENV=production \
	RIVER_CLOUDEVENTS_ID=${RIVER_CLOUDEVENTS_ID} \
	RIVER_CLOUDEVENTS_MECHANISM=${RIVER_CLOUDEVENTS_MECHANISM} \
	RIVER_CLOUDEVENTS_PASSWORD=${RIVER_CLOUDEVENTS_PASSWORD} \
	RIVER_CLOUDEVENTS_PROTOCOL=${RIVER_CLOUDEVENTS_PROTOCOL} \
	RIVER_CLOUDEVENTS_URLS=${RIVER_CLOUDEVENTS_URLS} \
	RIVER_CLOUDEVENTS_USERNAME=${RIVER_CLOUDEVENTS_USERNAME}

CMD [ "npm", "run", "start" ]
